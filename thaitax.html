<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Tax</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        window.onload = function() {

            const outputDiv = document.getElementById("outputDiv");
            const taxTableDiv = document.getElementById("taxTableDiv");
            const inputAmount = document.getElementById("inputAmount");

            function getTaxGrades() {
                return [
                    [150000, 5],
                    [300000, 10],
                    [500000, 15],
                    [750000, 20],
                    [1000000, 25],
                    [2000000, 30],
                    [5000000, 35]
                ];
            }

            function formatMoney(amount) {
                return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }

            function inputAmountOnInput(e) {
                let v = Math.floor(e.target.value);
                console.log('------------');
                const taxGrades = getTaxGrades();
                let totalTax = 0;
                for (let i = taxGrades.length - 1; i >= 0; i--) {
                    if (v > taxGrades[i][0]) {
                        let part = v - taxGrades[i][0];
                        let tax = part * taxGrades[i][1] / 100;
                        totalTax += tax;
                        console.log(taxGrades[i][0] + ' ' + part + ' tax: ' + taxGrades[i][1] + '% = ' + tax);
                        v = v - part;
                    }
                }

                outputDiv.innerHTML = 'Налог: ' + formatMoney(totalTax) + ' бат';
            }

            function fillTaxTable() {
                const taxGrades = getTaxGrades();
                let outputLines = ['Расчет налога производится по следующей схеме:'];
                outputLines.push('0% до ' + formatMoney(taxGrades[0][0]) + ' бат');
                for (let i = 0; i < taxGrades.length; i++) {
                    let s = taxGrades[i][1] + '% от ' + formatMoney(taxGrades[i][0]);
                    if (i + 1 < taxGrades.length) {
                        s += ' до ' + formatMoney(taxGrades[i + 1][0]);
                    }
                    outputLines.push(s + ' бат');
                }
                taxTableDiv.innerHTML = outputLines.join('<br>');
            }

            fillTaxTable();
            inputAmount.addEventListener("input", inputAmountOnInput);
        };
    </script>
</head>
<body>
<h1>Thai Tax 2024</h1>
<div>
    <div id="taxTableDiv"></div>
    <br>
    <div>
        <label for="inputAmount">Общая сумма поступлений (баты):</label>
        <input type="number" id="inputAmount" name="inputAmount">
    </div>
    <br>
    <div id="outputDiv"></div>
    <br><br>
    <div>
        <a href="https://www.youtube.com/watch?v=SLz-hSF0VDk">Циферки взяты из этого видосика</a>
    </div>
</div>
</body>
</html>
