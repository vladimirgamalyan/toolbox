<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thai Tax</title>
    <link rel="stylesheet" href="styles.css">
    <script>
        window.onload = function() {

            const outputDiv = document.getElementById("outputDiv");
            const taxTableDiv = document.getElementById("taxTableDiv");
            const inputAmount = document.getElementById("inputAmount");

            function getTaxGrades() {
                return [
                    [150000, 5],
                    [300000, 10],
                    [500000, 15],
                    [750000, 20],
                    [1000000, 25],
                    [2000000, 30],
                    [5000000, 35]
                ];
            }

            function formatMoney(amount) {
                return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ' ');
            }

            function getTaxGradesExt() {
                let taxGrades = getTaxGrades();
                taxGrades.unshift([0, 0]);
                taxGrades.push([-1, 0]);
                let result = [];
                for (let i = 0; i < taxGrades.length - 1; i++) {
                    result.push([taxGrades[i][0], taxGrades[i + 1][0], taxGrades[i][1]]);
                }
                return result;
            }

            function inputAmountOnInput(e) {
                let v = Math.floor(e.target.value);
                console.log('------------');
                const taxGrades = getTaxGrades();
                //let outputLines = [];
                //outputLines.push('Общая сумма: ' + formatMoney(v));
                let totalTax = 0;
                for (let i = taxGrades.length - 1; i >= 0; i--) {
                    if (v > taxGrades[i][0]) {
                        let part = v - taxGrades[i][0];
                        let tax = part * taxGrades[i][1] / 100;
                        totalTax += tax;
                        console.log(taxGrades[i][0] + ' ' + part + ' tax: ' + taxGrades[i][1] + '% = ' + tax);
                        v = v - part;
                    }
                }

                //outputDiv.innerHTML = outputLines.join('<br>');
                outputDiv.innerHTML = 'Налог: ' + formatMoney(totalTax) + ' бат';
            }

            function fillTaxTable() {

                function toMoneyString(v) {
                    if (v === -1) {
                        return 'бесконечности';
                    }
                    return formatMoney(v);
                }

                const taxGrades = getTaxGradesExt();
                let outputLines = ['Расчет налога производится по следующей таблице:'];
                taxGrades.forEach(function(i) {
                    outputLines.push('От ' + formatMoney(i[0]) + ' до ' + toMoneyString(i[1]) + ': ' + i[2] + '%');
                });
                taxTableDiv.innerHTML = outputLines.join('<br>');
            }

            fillTaxTable();
            inputAmount.addEventListener("input", inputAmountOnInput);
        };
    </script>
</head>
<body>
<h1>Thai Tax</h1>
<div>
    <div id="taxTableDiv"></div>
    <br>
    <div>
        <label for="inputAmount">Общая сумма дохода (баты):</label>
        <input type="number" id="inputAmount" name="inputAmount">
    </div>
    <br>
    <div id="outputDiv"></div>
</div>
</body>
</html>
